<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Rush Fixed</title>
    <style>
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: #000;
            font-family: sans-serif;
            touch-action: none; 
        }
        canvas { display: block; width: 100vw; height: 100vh; }
        
        /* UI Container */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; /* Force it to the very top */
        }

        #score-board {
            position: absolute; top: 20px; left: 20px;
            color: #0ff; font-size: 24px; font-weight: bold;
            text-shadow: 0 0 10px #0ff; pointer-events: none;
        }

        #menu {
            background: rgba(0, 0, 0, 0.9);
            padding: 40px; border-radius: 20px; border: 2px solid #f0f;
            text-align: center; pointer-events: auto;
        }

        h1 { color: #f0f; font-size: 32px; margin: 0 0 20px 0; text-shadow: 0 0 10px #f0f; }
        
        #start-btn {
            background: #0ff; border: none; padding: 20px 40px;
            color: #000; font-size: 20px; font-weight: bold;
            border-radius: 10px; cursor: pointer;
            box-shadow: 0 0 20px #0ff;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="score-board">SCORE: 0</div>

    <div id="ui">
        <div id="menu">
            <h1>NEON RUSH</h1>
            <button id="start-btn">START ENGINE</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui');
        const startBtn = document.getElementById('start-btn');
        const scoreEl = document.getElementById('score-board');

        let width, height, player, obstacles, particles, isPlaying = false, score = 0, gameSpeed = 5;

        function init() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            player = { x: width / 2, y: height - 100, w: 40, h: 70 };
            obstacles = [];
            particles = [];
        }

        function spawn() {
            if (!isPlaying) return;
            const type = Math.random() > 0.8 ? 'coin' : 'enemy';
            obstacles.push({
                x: Math.random() * (width - 40) + 20,
                y: -50,
                w: 40, h: 40, type: type
            });
            setTimeout(spawn, Math.max(200, 1000 - (score/10)));
        }

        function update() {
            if (!isPlaying) return;
            score += 1;
            gameSpeed += 0.002;
            
            obstacles.forEach((ob, i) => {
                ob.y += gameSpeed;
                // Collision
                if (Math.abs(player.x - ob.x) < 35 && Math.abs(player.y - ob.y) < 40) {
                    if (ob.type === 'enemy') {
                        isPlaying = false;
                        ui.classList.remove('hidden');
                        document.querySelector('h1').innerText = "GAME OVER";
                    } else {
                        score += 500;
                        obstacles.splice(i, 1);
                    }
                }
                if (ob.y > height) obstacles.splice(i, 1);
            });
            scoreEl.innerText = "SCORE: " + score;
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);

            // Road Lines
            ctx.strokeStyle = '#333';
            for(let i=0; i<width; i+=width/6) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke();
            }

            // Player
            ctx.fillStyle = '#0ff';
            ctx.shadowBlur = 15; ctx.shadowColor = '#0ff';
            ctx.fillRect(player.x - 20, player.y - 35, 40, 70);

            // Obstacles
            obstacles.forEach(ob => {
                ctx.fillStyle = ob.type === 'enemy' ? '#f0f' : '#ff0';
                ctx.shadowColor = ctx.fillStyle;
                ctx.fillRect(ob.x - 20, ob.y - 20, 40, 40);
            });
            ctx.shadowBlur = 0;
            
            if (isPlaying) {
                update();
                requestAnimationFrame(draw);
            }
        }

        // INPUT: Works for both Mouse and Touch
        const handleMove = (e) => {
            if (!isPlaying) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            player.x = clientX;
        };

        window.addEventListener('touchmove', handleMove, { passive: false });
        window.addEventListener('mousemove', handleMove);

        // THE START FIX: Use both click and touchstart for instant response
        const startAction = (e) => {
            e.preventDefault();
            init();
            isPlaying = true;
            ui.classList.add('hidden');
            spawn();
            draw();
        };

        startBtn.addEventListener('touchstart', startAction);
        startBtn.addEventListener('click', startAction);

        window.addEventListener('resize', init);
        init(); // Initial setup
    </script>
</body>
</html>
